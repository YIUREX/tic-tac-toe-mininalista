<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>3 en raya — Minimal</title>
<meta name="theme-color" content="#f5f5f5" />
<link rel="manifest" href="data:application/manifest+json,{
  &quot;name&quot;:&quot;3 en Raya Minimal&quot;,
  &quot;short_name&quot;:&quot;3 en Raya&quot;,
  &quot;start_url&quot;:&quot;.&quot;,
  &quot;display&quot;:&quot;standalone&quot;,
  &quot;background_color&quot;:&quot;#f5f5f5&quot;,
  &quot;theme_color&quot;:&quot;#f5f5f5&quot;,
  &quot;orientation&quot;:&quot;portrait&quot;
}">
<style>
:root{
  --bg: #f5f5f5;
  --card: #ffffff;
  --muted: #6b7280;
  --accent: #2563eb;
  --cell-size: min(26vmin, 100px);
}
*{box-sizing:border-box}
html,body{height:100%;margin:0;font-family:Inter,system-ui,sans-serif;background:var(--bg);color:#111}
body{display:flex;align-items:center;justify-content:center;padding:16px}
.wrap{width:100%;max-width:640px;display:flex;flex-direction:column;gap:20px}
.panel{background:var(--card);border-radius:16px;padding:16px;box-shadow:0 2px 10px rgba(0,0,0,0.08)}
h1{margin:0;font-size:20px}
p.lead{margin:0;color:var(--muted);font-size:14px}
.board{display:grid;grid-template-columns:repeat(3,var(--cell-size));grid-template-rows:repeat(3,var(--cell-size));gap:8px;justify-content:center}
.cell{display:flex;align-items:center;justify-content:center;background:#f0f0f0;border-radius:12px;font-size:2em;cursor:pointer;transition:background .2s}
.cell:hover{background:#e0e0e0}
.cell.disabled{pointer-events:none;opacity:.6}
.score{display:flex;justify-content:space-between;font-size:14px;margin-top:10px}
button.btn{padding:10px;border:none;border-radius:8px;cursor:pointer;font-weight:600}
button.primary{background:var(--accent);color:white}
button.secondary{background:#e5e7eb;color:#111}
.modal-bg{position:fixed;inset:0;background:rgba(0,0,0,0.4);display:flex;align-items:center;justify-content:center;visibility:hidden;opacity:0;transition:.2s}
.modal{background:white;padding:20px;border-radius:12px;max-width:90%;box-shadow:0 4px 20px rgba(0,0,0,0.2);text-align:center}
.modal h2{margin-top:0}
.modal-bg.show{visibility:visible;opacity:1}
</style>
</head>
<body>
<div class="wrap">
  <div class="panel">
    <h1>3 en raya</h1>
    <p class="lead">Minimal, móvil y con IA</p>
    <div id="board" class="board"></div>
    <div class="score">
      <span>Tú (X): <b id="scoreX">0</b></span>
      <span>Empates: <b id="scoreT">0</b></span>
      <span>IA (O): <b id="scoreO">0</b></span>
    </div>
    <div style="display:flex;gap:8px;margin-top:10px">
      <button id="restart" class="btn secondary">Reiniciar</button>
      <button id="newRound" class="btn primary">Nueva ronda</button>
    </div>
  </div>
</div>

<div id="modalBg" class="modal-bg">
  <div class="modal">
    <h2 id="modalTitle"></h2>
    <button id="modalClose" class="btn primary" style="margin-top:12px">Aceptar</button>
  </div>
</div>

<script>
// Elementos
const boardEl = document.getElementById('board');
const modalBg = document.getElementById('modalBg');
const modalTitle = document.getElementById('modalTitle');
const modalClose = document.getElementById('modalClose');
const scoreXEl = document.getElementById('scoreX');
const scoreOEl = document.getElementById('scoreO');
const scoreTEl = document.getElementById('scoreT');

let board = Array(9).fill(null);
let current = 'X';
let playing = true;
let scores = {X:0,O:0,T:0};

// Modal
function showModal(text){modalTitle.textContent=text;modalBg.classList.add('show');}
modalClose.onclick=()=>modalBg.classList.remove('show');

// Crear tablero
function createBoard(){
  boardEl.innerHTML='';
  for(let i=0;i<9;i++){
    const cell=document.createElement('div');
    cell.className='cell';
    cell.onclick=()=>onCell(i);
    boardEl.appendChild(cell);
  }
}
function render(){
  for(let i=0;i<9;i++){
    const cell=boardEl.children[i];
    cell.textContent=board[i]||'';
    cell.classList.toggle('disabled',!!board[i]||!playing);
  }
}

// Lógica de jugada
function onCell(i){
  if(!playing||board[i])return;
  board[i]=current;
  let res=checkGame();
  if(res){endGame(res);return;}
  current = 'O';
  render();
  setTimeout(aiMove,300);
}

// IA básica
function aiMove(){
  if(!playing) return;
  let move = findBestMove();
  board[move] = 'O';
  let res = checkGame();
  if(res){endGame(res);return;}
  current = 'X';
  render();
}

// IA: busca ganar o bloquear
function findBestMove(){
  const wins=[[0,1,2],[3,4,5],[6,7,8],[0,3,6],[1,4,7],[2,5,8],[0,4,8],[2,4,6]];
  // Intentar ganar
  for(let [a,b,c] of wins){
    let line=[board[a],board[b],board[c]];
    if(line.filter(v=>v==='O').length===2 && line.includes(null)){
      return [a,b,c][line.indexOf(null)];
    }
  }
  // Bloquear
  for(let [a,b,c] of wins){
    let line=[board[a],board[b],board[c]];
    if(line.filter(v=>v==='X').length===2 && line.includes(null)){
      return [a,b,c][line.indexOf(null)];
    }
  }
  // Centro
  if(board[4]===null) return 4;
  // Esquinas
  const corners=[0,2,6,8].filter(i=>board[i]===null);
  if(corners.length) return corners[Math.floor(Math.random()*corners.length)];
  // Laterales
  const sides=[1,3,5,7].filter(i=>board[i]===null);
  return sides[Math.floor(Math.random()*sides.length)];
}

function checkGame(){
  const wins=[[0,1,2],[3,4,5],[6,7,8],[0,3,6],[1,4,7],[2,5,8],[0,4,8],[2,4,6]];
  for(const [a,b,c] of wins){
    if(board[a]&&board[a]===board[b]&&board[a]===board[c])return board[a];
  }
  if(board.every(Boolean))return 'T';
  return null;
}

function endGame(res){
  playing=false;
  if(res==='X'){scores.X++;showModal('¡Ganaste!');}
  else if(res==='O'){scores.O++;showModal('La IA ganó');}
  else{scores.T++;showModal('Empate');}
  updateScores();
  render();
}

function updateScores(){
  scoreXEl.textContent=scores.X;
  scoreOEl.textContent=scores.O;
  scoreTEl.textContent=scores.T;
}

document.getElementById('restart').onclick=()=>{
  scores={X:0,O:0,T:0};
  reset(true);
};
document.getElementById('newRound').onclick=()=>reset(true);

function reset(newRound=false){
  board=Array(9).fill(null);
  playing=true;
  current='X';
  render();
  updateScores();
}

// Service Worker inline
if('serviceWorker' in navigator){
  const swCode=`
    const CACHE='3enraya-v1';
    self.addEventListener('install',e=>{e.waitUntil(caches.open(CACHE).then(c=>c.addAll(['./'])));});
    self.addEventListener('fetch',e=>{e.respondWith(caches.match(e.request).then(r=>r||fetch(e.request)));});
  `;
  const blob=new Blob([swCode],{type:'application/javascript'});
  navigator.serviceWorker.register(URL.createObjectURL(blob));
}

// Install prompt
window.addEventListener('beforeinstallprompt',(e)=>{
  e.preventDefault();
  showModal('Instala la app desde las opciones de tu navegador para jugar offline.');
});

createBoard();
render();
updateScores();
</script>
</body>
</html>
